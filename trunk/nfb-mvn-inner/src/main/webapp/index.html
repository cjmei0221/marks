<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>管理平台</title>
<link rel="stylesheet" type="text/css"
	href="css/easyui/themes/default/easyui.css">
<link rel="stylesheet" type="text/css" href="css/easyui/themes/icon.css">
<link rel="stylesheet" type="text/css" href="css/easyui/demo.css">
<script type="text/javascript" src="js/jquery-1.8.0.min.js"></script>
<script type="text/javascript" src="js/easyUI/jquery.easyui.min.js"></script>
<script type="text/javascript" src="js/base-config.js"></script>
<style type="text/css">
.welcometop {
	position: relative;
	width: 100%;
}

.menuCls {
	margin: 1px;
	padding: 10px;
	background-color: #e6eef8;
}
#idx-header{
	margin: 0px;
	padding: 0px;
}
.SysTitleCls{
	color: #c06020;
	margin: 0px;
	padding: 0px;
	font-size: 21px;
	font-family:微软雅黑;
}
</style>
</head>
<body class="easyui-layout">

		<div data-options="region:'north'" style="height: 50px">
			<div id="idx-header">
				<span class="SysTitleCls">管理平台</span><br/>登录用户：<span id="loginUser"></span> 登录时间：<span
					id="loginTime"></span>&nbsp;&nbsp;<a id="logout" href="javascript:;">退出</a>
			</div>
		</div>
		<div data-options="region:'south',split:true" style="height: 30px;">管理平台@cjmei</div>
		<div
			data-options="region:'west',split:true,hideCollapsedContent:false,collapsed:false"
			title="功能菜单" style="width: 150px;">

			<div id="menuControl" class="easyui-accordion"
				data-options="multiple:true" style="width: 100%;">

			</div>

		</div>
		<div data-options="region:'center'">
			<div id="mainregion" class="easyui-tabs"
				data-options="tabWidth:100,tools:'#tab-tools'"
				style="width: 100%; height: 100%;">
				<div title="欢迎" style="padding: 10px">
					<div class="welcometop">
						<img src="images/welcome.jpg" width="100%" height="490px;">
					</div>
				</div>
			</div>
			<div id="tab-tools">
				<!-- <a href="javascript:void(0)" class="easyui-linkbutton"
					data-options="plain:true,iconCls:'icon-add'" onclick="addPanel()"></a> -->
				<a href="javascript:void(0)" class="easyui-linkbutton"
					data-options="plain:true,iconCls:'icon-remove'"
					onclick="removePanel()"></a>
			</div>
		</div>
</body>
<script type="text/javascript">
	var appInfo = {
		menuUrl : top.window.urlBase + "/sys/menu.do"
		,logoutUrl : top.window.urlBase + "/sys/logout.do"
	}
	//添加面板
	/* var index = 0;
	function addPanel() {
		index++;
		$('#mainregion').tabs('add', {
			title : 'Tab' + index,
			content : '<div style="padding:10px">Content' + index + '</div>',
			closable : true
		});
	} */
	//删除面板
	function removePanel() {
		var tab = $('#mainregion').tabs('getSelected');
		if (tab) {
			var index = $('#mainregion').tabs('getTabIndex', tab);
			$('#mainregion').tabs('close', index);
		}
	}
	//添加新菜单面板
	function addAccordionPanel(checkItem,title, content) {
		$('#menuControl').accordion('add', {
			title : title,
			content : content,
			selected : checkItem
		});
	}
	//添加点击子菜单添加选项卡
	function addPanel(menuid, menuName, menuUrl) {
		var murl = menuUrl + "?menuid=" + menuid + "&t="
				+ (new Date().getTime());
		addTab(menuName, murl);
	}
	//加载菜单
	function loadMenu() {
		$.ajax({
					type : "GET",
					url : appInfo.menuUrl,
					success : function(data) {
						checkLogin(data);
						if (data.retcode == 0) {
							//赋值登录用户信息
							$("#loginUser").html(data.loginUser.username);
							$("#loginTime").html(data.loginUser.loginTime);
							//封装菜单
							$('#menuControl').empty(); //清空menuControl里面的所有内容
							var mlist = data.menuList;
							if (mlist.length > 0) {
								var checkItem=false;
								$.each(mlist,function(commentIndex, comment) {
									if(commentIndex==0){
										checkItem=true;
									}else{
										checkItem=false;
									}
									var childHtml = "";
									$.each(comment.children,function(childIdx,childComment) {
										childHtml += '<p id="'
											+ childComment.menuid
											+ '" class="menuCls" onclick="addPanel(\''
											+ childComment.menuid
											+ '\',\''
											+ childComment.menuitem
											+ '\',\''
											+ childComment.url
											+ '\')">'
											+ childComment.menuitem
											+ '</p>';
									});								
									addAccordionPanel(checkItem,comment.menuitem,childHtml);
								});					
							}
						}
					}
				});
	}
	
	//退出相应函数
	function logoutFunc() {
		$.ajax({
					type : "GET",
					url : appInfo.logoutUrl,
					success : function(data) {
						location.href="login.html";
					}
				});
	}
	$(function() {
		loadMenu();
		$("#logout").on("click",function(){
			logoutFunc();
		});
		//$("#mainregion").tabs('resize', {width:$(window).width()-155});
	});
</script>
</html>