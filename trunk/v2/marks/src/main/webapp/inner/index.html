<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>管理平台</title>
<link rel="stylesheet" type="text/css"
	href="easyui/css/themes/bootstrap/easyui.css">
<link rel="stylesheet" type="text/css" href="easyui/css/themes/icon.css">
<link rel="stylesheet" type="text/css" href="css/base.css">
<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="easyui/js/jquery.easyui.min.js"></script>
<script type="text/javascript" src="js/base-config.js"></script>
<style type="text/css">
.welcometop {
	position: relative;
	width: 100%;
}

.menuCls {
	margin: 1px;
	padding: 10px;
	background-color: #e6eef8;
}

#idx-header {
	margin: 0px;
	padding: 0px;
}

.SysTitleCls {
	color: blue;
	margin: 0px;
	font-size: 21px;
	font-family: 微软雅黑;
	padding-top: 10px;
	padding-left: 20px;
}

.loginout a {
	float: left;
	background-color: #3A97F1;
	position: absolute;
	width: 53px;
	margin-left: 92.5%;
	height: 100%;
	text-decoration: none;
	top: 0px;
}

.loginout a div {
	text-decoration: none;
	color: white;
	text-align: center;
	height: 50px;
	padding-top: 20px;
	font-size: 13px;
}

.sysName {
	position: relative;
	left: 21px;
	top: 9px;
	font-size: 20px;
	font-weight: 600;
	font-family: "宋体";
	color: #065AAB;
}
</style>
</head>
<body class="easyui-layout">

	<div data-options="region:'north'" style="height: 50px">
		<div id="idx-header">
			<!-- <img src="images/logo.png"
				style="width: 146px; position: relative; left: 30px; top: 7px" /> --> <span
				class="sysName">管理平台</span>

			<div class="loginout" id="logout">
				<a href="#"><div>退出</div></a>
			</div>
		</div>
	</div>
	<div data-options="region:'south',split:false" style="height:20px;text-align:center;">管理平台</div>
	<div
		data-options="region:'west',split:false,hideCollapsedContent:false,collapsed:false"
		title="功能菜单" style="width: 150px;overflow-x: hidden;">

		<div id="menuControl" class="easyui-accordion"
			data-options="multiple:false,fit:true,animate:false" style="width: 150px;"></div>

	</div>
	<div data-options="region:'center'">
		<div id="mainregion" class="easyui-tabs"
			data-options="tabWidth:100,tools:'#tab-tools',fit:true"
			style="width: 100%; height: 100%;">
			<div title="欢迎" style="padding: 10px">
				<div class="welcometop">
					<img src="images/welcome.jpg" width="100%" height="490px;">
				</div>
			</div>
		</div>
		<div id="tab-tools">
			<!-- <a href="javascript:void(0)" class="easyui-linkbutton"
					data-options="plain:true,iconCls:'icon-add'" onclick="addPanel()"></a> -->
			<a href="javascript:void(0)" class="easyui-linkbutton"
				data-options="plain:true,iconCls:'icon-remove'"
				onclick="removePanel()"></a>
		</div>
	</div>

<script type="text/javascript">
	var appInfo = {
		menuUrl : top.window.urlBase + "/inner/sys/menu.do",
		logoutUrl : top.window.urlBase + "/inner/logout.do"
	}
	//添加面板
	/* var index = 0;
	function addPanel() {
		index++;
		$('#mainregion').tabs('add', {
			title : 'Tab' + index,
			content : '<div style="padding:10px">Content' + index + '</div>',
			closable : true
		});
	} */
	//删除面板
	function removePanel() {
		var tab = $('#mainregion').tabs('getSelected');
		if (tab) {
			var index = $('#mainregion').tabs('getTabIndex', tab);
			$('#mainregion').tabs('close', index);
		}
	}
	//添加新菜单面板
	function addAccordionPanel(checkItem, title, content) {
		$('#menuControl').accordion('add', {
			title : title,
			content : content,
			selected : checkItem
		});
	}
	//添加点击子菜单添加选项卡
	function addPanel(menuid, menuName, menuUrl) {
		var murl = menuUrl + "?menuid=" + menuid + "&t="
				+ (new Date().getTime());
		addTab(menuName, murl);
	}
	//加载菜单
	function loadMenu() {
		$.ajax({type : "GET",
					url : appInfo.menuUrl,
					success : function(data) {
						checkLogin(data);
						if (data.retcode == "0") {
							//赋值登录用户信息
							$("#loginUser").html(data.loginUser.username);
							$("#loginTime").html(data.loginUser.loginTime);
							//封装菜单
							$('#menuControl').empty(); //清空menuControl里面的所有内容
							var mlist = data.menuList;
							if (mlist.length > 0) {
								var checkItem = false;
								for(var i=0;i<mlist.length;i++){
									if (i == 0) {
										checkItem = true;
									} else {
										checkItem = false;
									}
									var childHtml = "";
									var childList=mlist[i].children;
									for(var j=0;j<childList.length;j++){
										childHtml += '<p id="'
											+ childList[j].menuid
											+ '" class="menuCls" onclick="addPanel(\''
											+ childList[j].menuid
											+ '\',\''
											+ childList[j].menuitem
											+ '\',\''
											+ childList[j].url
											+ '\')">'
											+ childList[j].menuitem
											+ '</p>';
									}
									addAccordionPanel(
											checkItem,
											mlist[i].menuitem,
											childHtml);
								}
							}
						}
					}
				});
	}

	//退出相应函数
	function logoutFunc() {
		$.ajax({
			type : "GET",
			url : appInfo.logoutUrl,
			success : function(data) {
				location.href = "login.html";
			}
		});
	}
	$(function() {
		loadMenu();
		$("#logout").on("click", function() {
			logoutFunc();
		});
		//$("#mainregion").tabs('resize', {width:$(window).width()-155});
	});
</script>
</body>
</html>