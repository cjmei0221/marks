<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cjmei.module.system.login.dao.SysUserDao">
	<!-- 加载系统参数 -->
	<select id="getRoleIdByUserTypeAndCompanyId" resultType="String">
		select t.roleid from tb_sys_role t where t.companyid=#{companyId} and t.usertype=#{userType}
	</select>
	<select id="getSysUserByUseridOrMobile" resultType="com.cjmei.module.system.login.pojo.SysUser">
		SELECT
		TSU.*
		FROM
		TB_SYS_USER tsu
		WHERE
		tsu.USERID = #{userid} or
		tsu.bind_mobile=#{userid}
	</select>
	<update id="updatePwd" flushCache="true">
		update tb_sys_user set
		password=#{password} where userid=#{userid}
	</update>
	<update id="updateSkin" flushCache="true">
		update tb_sys_user set
		skin=#{skin} where userid=#{userid}
	</update>
	<insert id="save" parameterType="com.cjmei.module.system.login.pojo.SysUser">
		<selectKey keyProperty="userid" resultType="String" order="BEFORE">SELECT
			'U'||SEQ_SYS_USER.nextval FROM dual
		</selectKey>
		INSERT INTO TB_SYS_USER sysuser
		(
		sysuser.USERID,
		sysuser.USERNAME,
		sysuser.PASSWORD,
		sysuser.BIND_MOBILE,
		sysuser.ACTIVEFLAG,
		sysuser.CREATETIME,
		sysuser.UPDATETIME,
		sysuser.CREATOR,
		sysuser.COMPANYID,
		sysuser.TOKEN,
		sysuser.USERTYPE,
		sysuser.BINDFLAG
		)
		VALUES(
		#{userid:VARCHAR},
		#{username:VARCHAR},
		#{password:VARCHAR},
		#{bind_mobile:VARCHAR},
		#{activeFlag:NUMERIC},
		sysdate,
		sysdate,
		#{creator:VARCHAR},
		#{companyId:VARCHAR},
		#{token:VARCHAR},
		#{userType:VARCHAR},
		#{bindFlag:NUMERIC}
		)
	</insert>
	<update id="update" parameterType="com.cjmei.module.system.login.pojo.SysUser">
		update tb_sys_user set
		password=#{password:VARCHAR},
		BINDFLAG=#{bindFlag:NUMERIC},
		USERNAME=#{username:VARCHAR},
		BIND_MOBILE=#{bind_mobile:VARCHAR},
		UPDATETIME=sysdate
		where userid=#{userid:VARCHAR}
	</update>
	
	<insert id="saveSysUserRole">

		INSERT INTO
		TB_SYS_USER_ROLE (
		USERID,
		ROLEID,
		CREATETIME,
		UPDATETIME,
		CREATOR

		)
		VALUES(
		#{userid:VARCHAR},
		#{roleid:VARCHAR},
		sysdate,
		sysdate,
		#{creator:VARCHAR}
		)
	</insert>
	<insert id="saveSysUserOrg" >
		INSERT INTO
		tb_sys_user_org (
		USERID,
		ORGID,
		CREATETIME,
		UPDATETIME,
		CREATOR
		)
		VALUES(
		#{userid:VARCHAR},
		#{orgid:VARCHAR},
		sysdate,
		sysdate,
		#{creator:VARCHAR}
		)
	</insert>
</mapper>